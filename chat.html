<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JobinKI – Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .chat-box {
      max-height: 70vh;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-[#320366] to-[#3533cd] text-white flex items-center justify-center min-h-screen px-4">
  <div class="w-full max-w-2xl bg-white text-black rounded-xl shadow-xl p-6">
    <h1 class="text-2xl font-semibold text-center mb-4">Starte dein Gespräch</h1>
    
    <div id="chat" class="chat-box mb-4 space-y-3"></div>
    
    <form id="chat-form" class="flex gap-2">
      <input
        type="text"
        id="user-input"
        placeholder="Deine Antwort..."
        class="flex-1 border rounded px-3 py-2"
        required
      />
      <button type="submit" class="bg-[#320366] text-white px-4 py-2 rounded hover:bg-[#2c2abf]">
        Senden
      </button>
    </form>
  </div>

  <script>
    const chatContainer = document.getElementById("chat");
    const form = document.getElementById("chat-form");
    const input = document.getElementById("user-input");

    const fragen = [
      "Wie ist dein Name?",
      "Wann bist du geboren?",
      "Welche Sprachen sprichst du?",
      "Nach welchen Stellen dürfen wir für dich suchen?",
      "Was ist die Beruf?",
	  "Wieviele Jahre Berufserfahrung hast du in dem Bereich?",
	  "Welche Qualifikationen bringst du mit?",
	  "Welche Erfahrungen hast du gesammelt, die nicht durch Zeugnisse oder Zertifikate nachweisbar sind, aber dir heute helfen deine Stärken einzusetzen?",
	  "Wenn du dich heute frei entscheiden könntest, was würdest du gerne beruflich machen?",
      "Gab es berufliche Umwege, Brüche oder Neustarts in deinem Leben, die dich besonders geprägt haben?",
	  "Hast du dir neues Wissen oder Fähigkeiten in den letzten Jahren selbst beigebracht?",
	  "Hast du Interesse an einer beruflichen Neuorientierung?",
	  "Würdest du ein Praktikum in Erwägung ziehen, wenn du ein Job findest der ausschliesslich deinen persönlichen Fähigkeiten entspricht?",
	  "Welche Werte sind dir bei der Arbeit besonders wichtig?",
	  "Wie würdest du dich eher einschätzen? Introvertiert oder extrovertiert?",
	  "Wie würdest du deinen Arbeitsstil beschreiben?",
      "Welches Abeitsumfeld bevorzugst du? Büro, Hybrid, Remote?",
  	  "Wie sind deine Gehaltsvorstellungen?",
	  "Wo siehst du dich in 5 Jahren? Träume groß, so können wir dich besser kennenlernen.",
      "Gibt es etwas das du uns gerne noch mitteilen möchtest?",
      "Vielen Dank für deine Teilnahme, Bitte gib uns ein kurzes Feedback."
    ];

    let antworten = [];
    let frageIndex = 0;

    function neueNachricht(text, sender = "bot") {
      const div = document.createElement("div");
      div.className = sender === "bot" ? "text-left" : "text-right";
      div.innerHTML = `<div class="inline-block px-4 py-2 rounded-xl max-w-xs ${
        sender === "bot" ? "bg-gray-200 text-black" : "bg-[#3533cd] text-white"
      }">${text}</div>`;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function naechsteFrage() {
      if (frageIndex < fragen.length) {
        neueNachricht(fragen[frageIndex], "bot");
      } else {
        sendeAnOpenAI();
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const userText = input.value.trim();
      if (!userText) return;

      neueNachricht(userText, "user");
      antworten.push({ frage: fragen[frageIndex], antwort: userText });
      input.value = "";
      frageIndex++;
      setTimeout(naechsteFrage, 500);
    });

    async function sendeAnOpenAI() {
      neueNachricht("Danke! Ich werte deine Antworten aus...", "bot");

      const prompt = antworten.map(pair => `${pair.frage} ${pair.antwort}`).join("\n");

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "API"
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: "Du bist ein Karriere-Coach. Analysiere die Angaben und schlage passende Stellen vor." },
              { role: "user", content: prompt }
            ]
          })
        });

        const data = await res.json();
        const reply = data.choices[0].message.content;
        neueNachricht(reply, "bot");
      } catch (error) {
        console.error(error);
        neueNachricht("Es gab ein Problem beim Abrufen deiner Vorschläge.", "bot");
      }
    }

    // Initiale Frage starten
    naechsteFrage();
  </script>
</body>
</html>